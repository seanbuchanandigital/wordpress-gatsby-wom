{"version":3,"sources":["../../src/steps/persist-cached-images.js"],"names":["persistPreviouslyCachedImages","helpers","imageNodeIds","key","length","forEach","nodeId","actions","touchNode","store","dispatch","imageNodes","setNodeIds","imageNodeMetaByUrl","setState","nodeMetaByUrl"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AAEA,MAAMA,6BAA6B,GAAG,YAAY;AAChD,QAAM;AAAEC,IAAAA;AAAF,MAAc,iCAApB,CADgD,CAGhD;;AACA,QAAMC,YAAY,GAAG,MAAM,+BAAmB;AAAEC,IAAAA,GAAG,EAAG;AAAR,GAAnB,CAA3B,CAJgD,CAMhD;;AACA,MAAID,YAAY,IAAIA,YAAY,CAACE,MAAjC,EAAyC;AACvC;AACAF,IAAAA,YAAY,CAACG,OAAb,CAAsBC,MAAD,IACnBL,OAAO,CAACM,OAAR,CAAgBC,SAAhB,CAA0B;AACxBF,MAAAA;AADwB,KAA1B,CADF,EAFuC,CAQvC;AACA;AACA;;AACAG,mBAAMC,QAAN,CAAeC,UAAf,CAA0BC,UAA1B,CAAqCV,YAArC;AACD;;AAED,QAAMW,kBAAkB,GAAG,MAAM,+BAAmB;AAClDV,IAAAA,GAAG,EAAG;AAD4C,GAAnB,CAAjC;;AAIA,MAAIU,kBAAJ,EAAwB;AACtBJ,mBAAMC,QAAN,CAAeC,UAAf,CAA0BG,QAA1B,CAAmC;AACjCC,MAAAA,aAAa,EAAEF;AADkB,KAAnC;AAGD;AACF,CA9BD","sourcesContent":["import store from \"~/store\"\nimport { getGatsbyApi } from \"~/utils/get-gatsby-api\"\nimport { getPersistentCache } from \"~/utils/cache\"\n\nconst persistPreviouslyCachedImages = async () => {\n  const { helpers } = getGatsbyApi()\n\n  // load up image node id's from cache\n  const imageNodeIds = await getPersistentCache({ key: `image-node-ids` })\n\n  // if they exist,\n  if (imageNodeIds && imageNodeIds.length) {\n    // touch them all so they don't get garbage collected by Gatsby\n    imageNodeIds.forEach((nodeId) =>\n      helpers.actions.touchNode({\n        nodeId,\n      })\n    )\n\n    // and set them to state to set back to cache later\n    // since we may append more image id's to the store down the line\n    // in onPostBuild, all imageNodeIds in state are cached for the next build\n    store.dispatch.imageNodes.setNodeIds(imageNodeIds)\n  }\n\n  const imageNodeMetaByUrl = await getPersistentCache({\n    key: `image-node-meta-by-url`,\n  })\n\n  if (imageNodeMetaByUrl) {\n    store.dispatch.imageNodes.setState({\n      nodeMetaByUrl: imageNodeMetaByUrl,\n    })\n  }\n}\n\nexport { persistPreviouslyCachedImages }\n"],"file":"persist-cached-images.js"}
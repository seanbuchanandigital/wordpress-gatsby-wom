{"version":3,"sources":["../../src/steps/set-image-node-id-cache.js"],"names":["setImageNodeIdCache","state","store","getState","imageNodes","gatsbyApi","nodeIds","length","key","value","nodeMetaByUrl"],"mappings":";;;;;;;AAAA;;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAMA,mBAAmB,GAAG,YAAY;AACtC,QAAMC,KAAK,GAAG,MAAMC,eAAMC,QAAN,EAApB;AACA,QAAM;AAAEC,IAAAA,UAAF;AAAcC,IAAAA;AAAd,MAA4BJ,KAAlC;;AAEA,MAAIG,UAAU,CAACE,OAAX,IAAsBF,UAAU,CAACE,OAAX,CAAmBC,MAA7C,EAAqD;AACnD,UAAM,+BAAmB;AACvBC,MAAAA,GAAG,EAAG,gBADiB;AAEvBC,MAAAA,KAAK,EAAEL,UAAU,CAACE;AAFK,KAAnB,CAAN;AAID;;AAED,MAAIF,UAAU,CAACM,aAAf,EAA8B;AAC5B,UAAM,+BAAmB;AACvBF,MAAAA,GAAG,EAAG,wBADiB;AAEvBC,MAAAA,KAAK,EAAEL,UAAU,CAACM;AAFK,KAAnB,CAAN;AAID;AACF,CAjBD","sourcesContent":["import store from \"~/store\"\nimport { setPersistentCache } from \"~/utils/cache\"\n\n// since we create image nodes in resolvers\n// we cache our image node id's on post build for production\n// and on create dev server for development\n// so we can touch our image nodes in both develop and build\n// so they don't get garbage collected by Gatsby\nconst setImageNodeIdCache = async () => {\n  const state = await store.getState()\n  const { imageNodes, gatsbyApi } = state\n\n  if (imageNodes.nodeIds && imageNodes.nodeIds.length) {\n    await setPersistentCache({\n      key: `image-node-ids`,\n      value: imageNodes.nodeIds,\n    })\n  }\n\n  if (imageNodes.nodeMetaByUrl) {\n    await setPersistentCache({\n      key: `image-node-meta-by-url`,\n      value: imageNodes.nodeMetaByUrl,\n    })\n  }\n}\n\nexport { setImageNodeIdCache }\n"],"file":"set-image-node-id-cache.js"}